<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:wifiCrack.ViewModels"
             xmlns:models="clr-namespace:wifiCrack.Models"
             x:Class="wifiCrack.Views.MainPage"
             x:DataType="viewmodels:MainViewModel"
             Title="WiFi Security Auditor">

    <Grid RowDefinitions="Auto,*,Auto">

        <!-- Header -->
        <Frame Grid.Row="0"
               BackgroundColor="{StaticResource Primary}"
               CornerRadius="0"
               Padding="20,15"
               HasShadow="True">
            <VerticalStackLayout Spacing="5">
                <Label Text="ðŸ” WiFi Security Auditor"
                       FontSize="24"
                       FontAttributes="Bold"
                       TextColor="White"/>

                <Label Text="{Binding StatusMessage}"
                       FontSize="14"
                       TextColor="White"
                       Opacity="0.9"/>
            </VerticalStackLayout>
        </Frame>

        <!-- Contenu principal -->
        <ScrollView Grid.Row="1">
            <VerticalStackLayout Padding="15" Spacing="15">

                <!-- Actions rapides -->
                <Frame Padding="15"
                       CornerRadius="15"
                       HasShadow="True"
                       BackgroundColor="{StaticResource CardBackground}">
                    <Grid ColumnDefinitions="*,*" ColumnSpacing="10">
                        <Button Grid.Column="0"
                                Text="ðŸ” Scanner"
                                Command="{Binding ScanCommand}"
                                BackgroundColor="{StaticResource Primary}"
                                TextColor="White"
                                CornerRadius="10"
                                Padding="15"/>

                        <Button Grid.Column="1"
                                Text="ðŸ”„ Actualiser"
                                Command="{Binding RefreshCommand}"
                                BackgroundColor="{StaticResource Secondary}"
                                TextColor="White"
                                CornerRadius="10"
                                Padding="15"/>
                    </Grid>
                </Frame>

                <!-- Indicateur de chargement -->
                <ActivityIndicator IsVisible="{Binding IsLoading}"
                                   IsRunning="{Binding IsLoading}"
                                   Color="{StaticResource Primary}"
                                   HeightRequest="40"/>

                <!-- Statistiques rapides -->
                <Frame Padding="15"
                       CornerRadius="15"
                       HasShadow="True"
                       BackgroundColor="{StaticResource CardBackground}"
                       IsVisible="{Binding Networks.Count}">
                    <Grid ColumnDefinitions="*,*,*" ColumnSpacing="10">
                        <VerticalStackLayout Grid.Column="0" Spacing="5">
                            <Label Text="{Binding Networks.Count}"
                                   FontSize="24"
                                   FontAttributes="Bold"
                                   HorizontalOptions="Center"
                                   TextColor="{StaticResource Primary}"/>
                            <Label Text="RÃ©seaux"
                                   FontSize="12"
                                   HorizontalOptions="Center"
                                   Opacity="0.7"/>
                        </VerticalStackLayout>

                        <BoxView Grid.Column="1"
                                 WidthRequest="1"
                                 Color="{StaticResource Gray300}"
                                 HorizontalOptions="Center"/>

                        <VerticalStackLayout Grid.Column="1" Spacing="5">
                            <Label FontSize="24"
                                   FontAttributes="Bold"
                                   HorizontalOptions="Center"
                                   TextColor="{StaticResource Success}">
                                <Label.Text>
                                    <MultiBinding StringFormat="{}{0}">
                                        <Binding Path="Networks.Count" />
                                    </MultiBinding>
                                </Label.Text>
                            </Label>
                            <Label Text="SÃ©curisÃ©s"
                                   FontSize="12"
                                   HorizontalOptions="Center"
                                   Opacity="0.7"/>
                        </VerticalStackLayout>

                        <BoxView Grid.Column="2"
                                 WidthRequest="1"
                                 Color="{StaticResource Gray300}"
                                 HorizontalOptions="Center"/>

                        <VerticalStackLayout Grid.Column="2" Spacing="5">
                            <Label Text="0"
                                   FontSize="24"
                                   FontAttributes="Bold"
                                   HorizontalOptions="Center"
                                   TextColor="{StaticResource Danger}"/>
                            <Label Text="VulnÃ©rables"
                                   FontSize="12"
                                   HorizontalOptions="Center"
                                   Opacity="0.7"/>
                        </VerticalStackLayout>
                    </Grid>
                </Frame>

                <!-- Liste des rÃ©seaux -->
                <Label Text="ðŸ“¡ RÃ©seaux DÃ©tectÃ©s"
                       FontSize="20"
                       FontAttributes="Bold"
                       Margin="0,10,0,0"/>

                <CollectionView ItemsSource="{Binding Networks}"
                                SelectionMode="Single"
                                SelectedItem="{Binding SelectedNetwork}"
                                SelectionChanged="OnNetworkSelected">
                    <CollectionView.EmptyView>
                        <VerticalStackLayout Padding="20" Spacing="10">
                            <Label Text="ðŸ“¡"
                                   FontSize="60"
                                   HorizontalOptions="Center"
                                   Opacity="0.3"/>
                            <Label Text="Aucun rÃ©seau dÃ©tectÃ©"
                                   FontSize="18"
                                   HorizontalOptions="Center"
                                   Opacity="0.5"/>
                            <Label Text="Appuyez sur 'Scanner' pour rechercher des rÃ©seaux WiFi"
                                   FontSize="14"
                                   HorizontalOptions="Center"
                                   HorizontalTextAlignment="Center"
                                   Opacity="0.5"/>
                        </VerticalStackLayout>
                    </CollectionView.EmptyView>

                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="models:WifiNetwork">
                            <Frame Margin="0,5"
                                   Padding="15"
                                   CornerRadius="15"
                                   HasShadow="True"
                                   BackgroundColor="{StaticResource CardBackground}">
                                <Frame.GestureRecognizers>
                                    <TapGestureRecognizer Tapped="OnNetworkTapped"/>
                                </Frame.GestureRecognizers>

                                <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="15">
                                    <!-- IcÃ´ne de sÃ©curitÃ© -->
                                    <Label Grid.Column="0"
                                           Text="{Binding SecurityIcon}"
                                           FontSize="32"
                                           VerticalOptions="Center"/>

                                    <!-- Informations du rÃ©seau -->
                                    <VerticalStackLayout Grid.Column="1" Spacing="5">
                                        <Label Text="{Binding Ssid}"
                                               FontSize="18"
                                               FontAttributes="Bold"/>

                                        <Label Text="{Binding SecurityType}"
                                               FontSize="14"
                                               Opacity="0.7"/>

                                        <HorizontalStackLayout Spacing="10">
                                            <Label Text="{Binding SignalQuality}"
                                                   FontSize="12"
                                                   Opacity="0.6"/>

                                            <Label Text="â€¢"
                                                   FontSize="12"
                                                   Opacity="0.6"/>

                                            <Label FontSize="12" Opacity="0.6">
                                                <Label.Text>
                                                    <MultiBinding StringFormat="Canal {0}">
                                                        <Binding Path="Channel"/>
                                                    </MultiBinding>
                                                </Label.Text>
                                            </Label>

                                            <Label Text="{Binding IsSaved}"
                                                   IsVisible="{Binding IsSaved}"
                                                   FontSize="12">
                                                <Label.FormattedText>
                                                    <FormattedString>
                                                        <Span Text="ðŸ’¾ SauvegardÃ©"/>
                                                    </FormattedString>
                                                </Label.FormattedText>
                                            </Label>
                                        </HorizontalStackLayout>
                                    </VerticalStackLayout>

                                    <!-- Score de sÃ©curitÃ© -->
                                    <Frame Grid.Column="2"
                                           Padding="10"
                                           CornerRadius="10"
                                           BackgroundColor="{StaticResource LightBackground}"
                                           VerticalOptions="Center">
                                        <VerticalStackLayout Spacing="2">
                                            <Label Text="{Binding SecurityScore}"
                                                   FontSize="20"
                                                   FontAttributes="Bold"
                                                   HorizontalOptions="Center"
                                                   TextColor="{StaticResource Primary}"/>
                                            <Label Text="/10"
                                                   FontSize="10"
                                                   HorizontalOptions="Center"
                                                   Opacity="0.6"/>
                                        </VerticalStackLayout>
                                    </Frame>
                                </Grid>
                            </Frame>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>

            </VerticalStackLayout>
        </ScrollView>

        <!-- Navigation du bas -->
        <Frame Grid.Row="2"
               BackgroundColor="{StaticResource CardBackground}"
               CornerRadius="0"
               Padding="10"
               HasShadow="True">
            <Grid ColumnDefinitions="*,*,*">
                <Button Grid.Column="0"
                        Text="ðŸ "
                        FontSize="24"
                        BackgroundColor="Transparent"/>

                <Button Grid.Column="1"
                        Text="ðŸ“š"
                        FontSize="24"
                        BackgroundColor="Transparent"
                        Clicked="OnEducationalClicked"/>

                <Button Grid.Column="2"
                        Text="âš™ï¸"
                        FontSize="24"
                        BackgroundColor="Transparent"
                        Clicked="OnSettingsClicked"/>
            </Grid>
        </Frame>

    </Grid>
</ContentPage>
